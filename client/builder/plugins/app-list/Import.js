// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"url:builder/plugins/app-list/Import.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"actions jimu-float-trailing" data-dojo-attach-point\x3d"actionsNode"\x3e\r\n    \x3cspan class\x3d"actions-label jimu-ellipsis" title\x3d"${nls.actionsLabel}" data-dojo-attach-event\x3d"onclick:_onActionsLabelClick"\x3e${nls.actionsLabel}\x3c/span\x3e\r\n    \x3cdiv class\x3d"actions-menu" data-dojo-attach-point\x3d"actionsMenu"\x3e\r\n      \x3cdiv class\x3d"actions-menu-item item-import" data-dojo-attach-point\x3d"itemImportBtn" data-dojo-attach-event\x3d"onclick:_onMenuItemClick"\x3e\r\n        \x3cdiv class\x3d"import-button jimu-ellipsis" title\x3d"${nls.importAction}" data-dojo-attach-event\x3d"onclick:_onImportClick"\x3e${nls.importAction}\x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"actions-menu-item item-upload" data-dojo-attach-event\x3d"onclick:_onMenuItemClick"\x3e\r\n        \x3cdiv class\x3d"upload-button-div"\x3e\r\n          \x3cdiv class\x3d"upload-button jimu-ellipsis" title\x3d"${nls.uploadAction}"\x3e${nls.uploadAction}\x3c/div\x3e\r\n          \x3cform enctype\x3d"multipart/form-data" encoding\x3d"multipart/form-data" title\x3d"${nls.uploadAction}" method\x3d"post" action\x3d"/webappbuilder/rest/apps/upload" data-dojo-attach-point\x3d"uploadAppFileFormNode"\x3e\r\n            \x3cinput class\x3d"file-input" title\x3d"${nls.uploadAction}" name\x3d"app" type\x3d"file" data-dojo-attach-point\x3d"appFileInputNode" data-dojo-type\x3d"dojox/form/Uploader" data-dojo-attach-event\x3d"onChange:_onAppFileChange,onError:_onAppFileUploadError,onComplete:_onAppFileUploadComplete" accept\x3d".zip" style\x3d"width:100%;height:100%;"\x3e\r\n            \x3cinput name\x3d"creator" type\x3d"text" value\x3d"1234" style\x3d"display:none;" data-dojo-attach-point\x3d"appFileCreatorInputNode"\x3e\r\n            \x3cinput name\x3d"portalUrl" type\x3d"text" style\x3d"display:none" data-dojo-attach-point\x3d"appPortalUrlInputNode"\x3e\r\n            \x3cinput name\x3d"fromList" type\x3d"text" style\x3d"display:none" data-dojo-attach-point\x3d"fromListNode"\x3e\r\n          \x3c/form\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n\r\n'}});
define("dojo/_base/declare dojo/_base/html dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./Import.html dojo/on dojo/_base/lang dojo/sniff builder/serviceUtils dojo/query jimu/dijit/Message jimu/dijit/ItemSelector jimu/dijit/Popup builder/portalUtils esri/lang builder/dijit/FullScreenPopup dojox/form/Uploader dojo/NodeList-dom".split(" "),function(p,b,q,r,t,u,e,c,v,m,k,g,w,h,n,f,x){return p([q,r,t],{baseClass:"import-app",templateString:u,_itemSelector:null,_importPopup:null,
nls:null,postMixInProperties:function(){this.inherited(arguments);this.nls=this.appListWidget.nls;this.loading=this.appListWidget.loading},startup:function(){this.inherited(arguments);this.own(e(window.document,"click",c.hitch(this,function(a){a.clickFromSelf||setTimeout(c.hitch(this,function(){b.setStyle(this.actionsMenu,"display","none");window.isRTL?b.setStyle(this.actionsMenu,{left:"auto",right:0}):b.setStyle(this.actionsMenu,{right:"auto",left:0});b.removeClass(this.actionsNode,"actions-drop-down")}),
50)})));this._applyZipToFileInput();this.appPortalUrlInputNode&&(this.appPortalUrlInputNode.value=window.portalUrl);this._keepFileChooserOverItem()},_applyZipToFileInput:function(){k('input[type\x3d"file"]',this.appFileInputNode.domNode).forEach(c.hitch(this,function(a){b.setAttr(a,"accept",".zip")}))},_keepFileChooserOverItem:function(){9>=v("ie")&&k("span.dijitUploader input:first-child",this.domNode).forEach(c.hitch(this,function(a){window.isRTL?b.setStyle(a,{left:"33px",right:"auto"}):b.setStyle(a,
"right","33px")}))},_onActionsLabelClick:function(a){var l=b.getMarginBox(window.jimuConfig.layoutId),d=null;"none"===b.getStyle(this.actionsMenu,"display")?(b.setStyle(this.actionsMenu,"display","block"),d=b.position(this.actionsMenu),window.isRTL?0>d.x&&b.setStyle(this.actionsMenu,{right:"auto",left:0}):d.x+d.w>l.w&&b.setStyle(this.actionsMenu,{left:"auto",right:0})):(b.setStyle(this.actionsMenu,"display","none"),d=b.position(this.actionsMenu),window.isRTL?b.setStyle(this.actionsMenu,{left:"auto",
right:0}):b.setStyle(this.actionsMenu,{right:"auto",left:0}));a.clickFromSelf=!0},_onMenuItemClick:function(a){setTimeout(c.hitch(this,function(){b.setStyle(this.actionsMenu,"display","none");b.removeClass(this.actionsNode,"actions-drop-down");a.stopPropagation()}),50)},_onAppFileUploadError:function(a){console.error(a);new g({message:a.message||a});this._keepFileChooserOverItem();this._applyZipToFileInput();this.loading.hide()},_onAppFileUploadComplete:function(a){a.success?(this._refreshAppOrTemplatePage(),
this._keepFileChooserOverItem(),this._applyZipToFileInput(),this.loading.hide()):this._onAppFileUploadError(a)},_onAppFileChange:function(){var a=this.appFileInputNode.getFileList();a&&0<a.length&&(/.+(\.zip)$/.test(a[0].name)?(this.loading.show(this.nls.uploading),n.getPortal(window.portalUrl).getUser().then(c.hitch(this,function(a){b.setAttr(this.appFileCreatorInputNode,"value",a.username);b.setAttr(this.fromListNode,"value",this._currentShownList);this.appFileInputNode.submit(this.uploadAppFileFormNode)}),
function(a){console.error(a);new g({message:a.message||a});this.loading.hide()})):new g({message:this.nls.fileTypeError}))},_onImportClick:function(){this._itemSelector=new w({portalUrl:window.portalUrl,itemTypes:["Web Mapping Application"],onlyShowOnlineFeaturedItems:!1,typeKeywords:["Web AppBuilder"],showOnlineItems:!1});this.own(e(this._itemSelector,"item-selected",c.hitch(this,function(){this._importPopup.enableButton(0)})));this.own(e(this._itemSelector,"none-item-selected",c.hitch(this,function(){this._importPopup.disableButton(0)})));
var a=k("#main-page")[0];this._importPopup=new x({zIndex:101,titleStr:this.nls.importApp,blurContainer:a.firstElementChild,content:this._itemSelector.domNode,buttons:[{label:this.nls.ok,isHighLight:!0,onClick:c.hitch(this,this._onImportOkClick)},{label:this.nls.cancel,isHighLight:!1,onClick:c.hitch(this,this._onImportCancelClick)}],contentAutoHeight:!0});this._importPopup.placeAt(a);this._importPopup.show();this._importPopup.disableButton(0);this._itemSelector.startup();this.own(e(this._itemSelector.tab,
"tabChanged",c.hitch(this,function(){window.setTimeout(c.hitch(this,function(){this._importPopup.resize()},100))})));this.own(e(this._itemSelector,"update",c.hitch(this,function(){this._importPopup.resize()})))},_onImportOkClick:function(){var a=this._itemSelector.getSelectedItem();this.loading.show();n.getPortal(window.portalUrl).getUser().then(c.hitch(this,function(b){a.getItemData().then(c.hitch(this,function(d){this.loading.hide();this._importPopup.close();d=c.clone(d);this._checkAppVersion(d,
{creator:b.username,name:a.title,description:a.description||"",appType:a.typeKeywords&&0<=a.typeKeywords.indexOf("WAB3D")?"HTML3D":"HTML",stemappPath:this.appListWidget.pluginManager.getStemappInfo("HTML").appPath,portalUrl:window.portalUrl,isTemplate:!1,isTemplateApp:!1,isPredefined:!1})}),c.hitch(this,function(d){this.loading.hide();this._checkAppInfoError(a.title,d)}))}),c.hitch(this,function(b){this.loading.hide();this._checkAppInfoError(a.title,b)}))},_checkAppVersion:function(a,b){this.loading.show(this.nls.importing);
m.checkAppVersion(a,b).then(c.hitch(this,function(d){this.loading.hide();d=d.versionInfo;"old"===d.wabVersionStatus?this._doAction("upgrade",a,b):"new"===d.wabVersionStatus?this._showNewer(b.name,d.appVersion):"same"===d.wabVersionStatus&&this._doAction("import",a,b)}),c.hitch(this,function(b){this.loading.hide();this._checkAppInfoError(a.title,b)}))},_checkAppInfoError:function(a,b){new g({message:f.substitute({APP_NAME:a},this.nls.checkVersionError)});console.error(b)},_showUpgrade:function(a,l,
d){d="\x3cdiv style\x3d'font-size:14px;'\x3e"+f.substitute({OLD_VERSION:d.appVersion,LATEST_VERSION:d.latestVersion},this.nls.upgradeContent)+"\x3cdiv style\x3d'height:24px;'\x3e\x3c/div\x3e"+this.nls.upgradeContentFooter+"\x3c/div\x3e";var e=new h({titleLabel:this.nls.upgradeApp,content:b.toDom(d),width:640,autoHeight:!0,buttons:[{label:this.nls.upgradeBtn,onClick:c.hitch(this,function(){e.close();this._doAction("upgrade",a,l)})},{label:this.nls.cancel,classNames:["jimu-btn-vacation"],onClick:c.hitch(this,
function(){e.close()})}]})},_showNewer:function(a,c){var d="\x3cdiv style\x3d'font-size:14px;'\x3e"+f.substitute({APP_NAME:a,VERSION_NUMBER:c},this.nls.importUpperVertion)+"\x3c/div\x3e";new h({titleLabel:this.nls.importApp,content:b.toDom(d),width:640,autoHeight:!0,buttons:[{label:this.nls.ok}]})},_doAction:function(a,b,d){"import"===a?this.loading.show(this.nls.importing):"upgrade"===a&&this.loading.show(this.nls.upgrading);m.importPortalApp(b,d).then(c.hitch(this,function(){this._importSuccess(d.appName)}),
c.hitch(this,function(a){this.loading.hide();this._importError(d.appName,a)}))},_importSuccess:function(a){this.appListWidget.getAppList().then(c.hitch(this,function(){this._refreshAppOrTemplatePage();var c="\x3cdiv style\x3d'font-size:14px;'\x3e"+f.substitute({APP_NAME:a},this.nls.importSuccess)+"\x3c/div\x3e";new h({titleLabel:this.nls.importApp,content:b.toDom(c),width:640,autoHeight:!0,buttons:[{label:this.nls.ok}]})}),c.hitch(this,function(a){console.error(a)})).always(c.hitch(this,function(){this.loading.hide()}))},
_importError:function(a,c){var d="\x3cdiv style\x3d'font-size:14px;'\x3e"+f.substitute({APP_NAME:a},this.nls.upgradeFailure)+"\x3c/div\x3e";new h({titleLabel:this.nls.importApp,content:b.toDom(d),width:640,autoHeight:!0,buttons:[{label:this.nls.ok}]});console.error(c)},_onImportCancelClick:function(){this._importPopup.close()},_refreshAppOrTemplatePage:function(){this.appListWidget.refreshTemplatePage();this.appListWidget.refreshAppPage()}})});